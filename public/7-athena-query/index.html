<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.124.1">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="../images/favicon.png" type="image/png">

    <title>Athena Query :: Start with Amazon VPC and AWS VPN Site-to-Site.</title>

    
    <link href="../css/nucleus.css?1711460118" rel="stylesheet">
    <link href="../css/fontawesome-all.min.css?1711460118" rel="stylesheet">
    <link href="../css/hybrid.css?1711460118" rel="stylesheet">
    <link href="../css/featherlight.min.css?1711460118" rel="stylesheet">
    <link href="../css/perfect-scrollbar.min.css?1711460118" rel="stylesheet">
    <link href="../css/auto-complete.css?1711460118" rel="stylesheet">
    <link href="../css/atom-one-dark-reasonable.css?1711460118" rel="stylesheet">
    <link href="../css/theme.css?1711460118" rel="stylesheet">
    <link href="../css/hugo-theme.css?1711460118" rel="stylesheet">
    
    <link href="../css/theme-workshop.css?1711460118" rel="stylesheet">
    
    

    <script src="../js/jquery-3.3.1.min.js?1711460118"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="../7-athena-query/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../js/lunr.min.js?1711460118"></script>
<script type="text/javascript" src="../js/auto-complete.js?1711460118"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:1313\/";
    
</script>
<script type="text/javascript" src="../js/search.js?1711460118"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/3-config-cloudtrail/" title="CloudTrail Configuring" class="dd-item 
        
        
        
        ">
      <a href="../3-config-cloudtrail/">
           <b> 1. </b> CloudTrail Configuring
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-add-iam/" title="Add IAM" class="dd-item 
        
        
        
        ">
      <a href="../4-add-iam/">
           <b> 2. </b> Add IAM
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-add-ec2/" title="Add EC2 Instance" class="dd-item 
        
        
        
        ">
      <a href="../5-add-ec2/">
           <b> 3. </b> Add EC2 Instance
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/6-stop-ec2/" title="Using dude-from-nowhere to Stop EC2 Instance" class="dd-item 
        
        
        
        ">
      <a href="../6-stop-ec2/">
           <b> 4. </b> Using dude-from-nowhere to Stop EC2 Instance
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/7-athena-query/" title="Athena Query" class="dd-item 
        
        active
        
        ">
      <a href="../7-athena-query/">
           <b> 5. </b> Athena Query
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/8-quicjsight-visualize/" title="Quicksight Visualize" class="dd-item 
        
        
        
        ">
      <a href="../8-quicjsight-visualize/">
           <b> 6. </b> Quicksight Visualize
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/9-clean-up/" title="Resources Clean Up" class="dd-item 
        
        
        
        ">
      <a href="../9-clean-up/">
           <b> 7. </b> Resources Clean Up
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://aws.amazon.com/blogs"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - FB Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="//localhost:1313/7-athena-query/" selected>English</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>26-11-2023</font></i>
    </left>
    <left>
        <br>
        <br>
        <b> Made with luv  </b> <br>
        <i> <a href="https://www.linkedin.com/in/lam-hoang-cat-vy/"  style="color:orange">Lam Hoang Cat Vy (Kathy Lam)</a> <br>

            <b> From Team FCJ</b> <br>
            <i> <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia HÆ°ng </a> <br>
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='../'>Building a Simple AWS CloudTrail Data Analytics Solution</a> > Athena Query
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#scenario">Scenario</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Athena Query
            </h1>
          

        



	<h2 id="scenario">Scenario</h2>
<p>People in your organization are saying that a web server was turned off and the website is now offline. Now, you will use CloudTrail data to investigate what happened and get evidence of the action, including:</p>
<ul>
<li>Who shut down the web server</li>
<li>When they shut it down</li>
<li>Where they shut it down from
You will do this investigation by creating an Athena table that points to the S3 bucket that is used by your new CloudTrail configuration.</li>
</ul>
<ol>
<li>
<p>As an AWS administrator: In the AWS Management Console, open the list of all AWS services by choosing Services, and locate and choose CloudTrail.
<img alt="01" src="../images/7-athena-query/01.png"></p>
</li>
<li>
<p>In the navigation pane, choose Event history, and then choose Create Athena table
<img alt="02" src="../images/7-athena-query/02.png"></p>
</li>
<li>
<p>In Storage location, choose the bucket you created as part of CloudTrail configuration. This action will update the structured query language (SQL) command that creates the table to use the corresponding bucket location</p>
</li>
<li>
<p>Choose <code>Create table</code>
<img alt="03" src="../images/7-athena-query/03.png"></p>
</li>
</ol>
<p>You now have an Athena table with the same schema that is used by CloudTrail. The table points to the recently created S3 bucket that is used by CloudTrail.</p>
<ol start="5">
<li>
<p>As an AWS administrator: In the AWS Management Console, open the list of all AWS services by choosing Services, and locate and choose Athena.
<img alt="04" src="../images/7-athena-query/04.png"></p>
</li>
<li>
<p>If this is the first time youâre using Athena in this AWS account, you will need configure some settings. In the upper-right area of the window, choose Settings.
<img alt="05" src="../images/7-athena-query/05.png"></p>
</li>
<li>
<p>Then, select another S3 bucket for the Athena query result location by choosing the Select button. A bucket might have been automatically created for this purpose, so you might only need to select a bucket with a name that starts with aws-athena-query-results, click <code>Choose</code>
<img alt="06" src="../images/7-athena-query/06.png"></p>
</li>
<li>
<p>After you select the bucket, choose Save, and you are ready to do Athena queries.
<img alt="07" src="../images/7-athena-query/07.png">
<img alt="08" src="../images/7-athena-query/08.png"></p>
</li>
<li>
<p>To get the activity history of a given EC2 instance, run the following query. Make sure to replace the instance ID with your instance ID. You also need to replace YOUR-ATHENA-TABLE-HERE with the name of your Athena table. You can copy the table name from the navigation pane. The query looks like this example:</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-SQL" data-lang="SQL"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span>
</span></span><span style="display:flex;"><span>    YOUR<span style="color:#f92672">-</span>ATHENA<span style="color:#f92672">-</span><span style="color:#66d9ef">TABLE</span><span style="color:#f92672">-</span>HERE
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> 
</span></span><span style="display:flex;"><span>    eventname <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;StopInstances&#39;</span> <span style="color:#66d9ef">AND</span>
</span></span><span style="display:flex;"><span>    useridentity.username <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;dude-from-nowhere&#39;</span>
</span></span></code></pre></div><ol start="10">
<li>Click <code>Run</code>.
<img alt="09" src="../images/7-athena-query/09.png"></li>
<li>Scroll down and review the query.
<img alt="10" src="../images/7-athena-query/10.png"></li>
</ol>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="../6-stop-ec2/" title="Using dude-from-nowhere to Stop EC2 Instance"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../8-quicjsight-visualize/" title="Quicksight Visualize" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../js/clipboard.min.js?1711460118"></script>
    <script src="../js/perfect-scrollbar.min.js?1711460118"></script>
    <script src="../js/perfect-scrollbar.jquery.min.js?1711460118"></script>
    <script src="../js/jquery.sticky.js?1711460118"></script>
    <script src="../js/featherlight.min.js?1711460118"></script>
    <script src="../js/highlight.pack.js?1711460118"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../js/modernizr.custom-3.6.0.js?1711460118"></script>
    <script src="../js/learn.js?1711460118"></script>
    <script src="../js/hugo-learn.js?1711460118"></script>

    <link href="../mermaid/mermaid.css?1711460118" rel="stylesheet" />
    <script src="../mermaid/mermaid.js?1711460118"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
